<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Distribution</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css" integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js" integrity="sha512-8RnEqURPUc5aqFEN04aQEiPlSAdE0jlFS/9iGgUyNtwFnSKCXhmB6ZTNl7LnDtDWKabJIASzXrzD0K+LYexU9g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <div id="editor"></div>
    <input id="stdin" type="text" placeholder="Type here and press Enter" />


    <script>
        const editor = CodeMirror(document.getElementById("editor"), {
            value: `; demoA.a: simple program assembly/execution and test input/output caching
    mov r0, 5
    dout r0
    nl
    halt`,
            mode: "lcc",
            theme: "material",
            lineNumbers: true,
            indentUnit: 4,
            tabSize: 4,
            indentWithTabs: true,
            lineWrapping: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            autoCloseBrackets: true,
            matchBrackets: true,
            autoCloseTags: true,
            matchTags: true,
            foldGutter: true,
            extraKeys: {
                "Ctrl-Space": "autocomplete",
                "Ctrl-S": function (cm) {
                    console.log(cm.getValue());
                }
            }
        });
    </script>

    <script>
        // FIXME: Remove hardcoded file inputs
        localStorage.clear(); // Clear local storage
        const fsWrapperStorage = {
            "file:///C:/Users/lettu/projects/lccjs/demos/demoA.a": `; demoA.a: simple program assembly/execution and test input/output caching
    mov r0, 5
    dout r0
    nl
    halt`,
            "file:/C:/Users/lettu/projects/lccjs/demos/name.nnn": "lettu"
        };

        localStorage.setItem("fsWrapper", JSON.stringify(fsWrapperStorage));
    </script>

    <script src="dist/bundle.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            


            const stdinElement = document.getElementById("stdin");

            stdinElement.addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    process.stdin.readSync(); // Manually read from buffer
                }
            });

            const lcc = new LCC.default();
            // subscribe to window.fsWrapperStorage.subscribe
            window.fsWrapperStorage.subscribe((type, key, value) => {
                console.log("fs", type, key, value);
            });
            lcc.main(["file:///C:/Users/lettu/projects/lccjs/demos/demoA.a"]);
        });
    </script>
</body>

</html>